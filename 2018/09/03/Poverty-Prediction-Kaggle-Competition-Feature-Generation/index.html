<html>
  <head>
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



<link href="/lib/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
<link href="/css/html.css" rel="stylesheet" type="text/css">
<link href="/css/header.css" rel="stylesheet" type="text/css">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">



<meta name="description" content="Creating new features for the Costa Rican household poverty level prediction competition">
<meta name="keywords" content="data science, katie clark, python, kaggle, costa rica, poverty prediction">

<title>Poverty Prediction Kaggle Competition: Feature Generation | Come with me now on a journey through code and data...</title>


<link href="/css/post.css" rel="stylesheet" type="text/css">
<link href="/css/notebook.css" rel="stylesheet" type="text/css">

<meta property="og:type" content="article">
<meta property="og:title" content="Poverty Prediction Kaggle Competition: Feature Generation">
<meta property="og:url" content="http://hello-klol.github.io/2018/09/03/Poverty-Prediction-Kaggle-Competition-Feature-Generation/index.html">
<meta property="og:site_name" content="Come with me now on a journey through code and data...">
<meta property="og:description" content="Creating new features for the Costa Rican household poverty level prediction competition">
<meta property="og:locale" content="English">
    <title>Poverty Prediction Kaggle Competition: Feature Generation</title>
  </head>
  <body>
<div class="header">
  <div class="title-bar">
    <span class="site-title">Come with me now on a journey through code and data...</span>
  </div>
  <nav class="site-nav">
    <ul>
      <li class="nav-item">
        <a href="/" rel="section">
          <i class="fa fa-fw fa-home"></i> <br>Home</a>
      </li>
      <li class="nav-item">
        <a href="/about/" rel="section">
          <i class="fa fa-fw fa-child"></i> <br>About</a>
      </li>
      <li class="nav-item">
        <a href="/archives/" rel="section">
          <i class="fa fa-fw fa-book"></i> <br>Blog</a>
      </li>
      <li class="nav-item">
        <a href="https://github.com/hello-klol" rel="external" target="_blank">
          <i class="fa fa-fw fa-github-alt"></i> <br>GitHub</a>
      </li>
      <li class="nav-item">
        <a href="https://twitter.com/_katie_clark_" rel="external" target="_blank">
          <i class="fa fa-fw fa-twitter"></i> <br>Twitter</a>
      </li>
      <li class="nav-item">
        <a href="https://stackoverflow.com/users/1168920/katie" rel="external" target="_blank">
          <i class="fa fa-fw fa-stack-overflow"></i> <br>StackOverflow</a>
      </li>
      <li class="nav-item">
        <a href="/katie-clark-resume.pdf" rel="section"i target="_blank">
          <i class="fa fa-fw fa-user"></i> <br>Resume</a>
      </li>
    </ul>
  </nav>
</div>
<article itemscope itemtype="http://schema.org/Article">
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://hello-klol.github.io/">

<span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
  <meta itemprop="name" content="Katie Clark">
  <meta itemprop="description" content="It's a Data Science blog">
  <meta itemprop="image" content="/images/avatar.gif">
</span>

<span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
  <meta itemprop="name" content="Come with me now on a journey through code and data...">
</span>
<span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <meta itemprop="name" content="Katie Clark">
  <meta itemprop="description" content="It's a Data Science blog">
  <meta itemprop="image" content="/images/avatar.gif">
</span>
<span>
  <meta itemprop="name" content="Come with me now on a journey through code and data...">
</span>


<header>
  <link itemprop="mainEntityOfPage" href="http://hello-klol.github.io/2018/09/03/Poverty-Prediction-Kaggle-Competition-Feature-Generation/">
    <h1 class="post-title" itemprop="name headline">Poverty Prediction Kaggle Competition: Feature Generation</h1>
  </link>
  <div class="post-meta">
    <span class="post-meta-icon">
      <i class="fa fa-calendar-o"></i>
    </span>
    <span class="post-meta-text">Posted on</span>
    <time title="Created: 2018-09-03 00:00:00" itemprop="dateCreated datePublished" datetime="2018-09-03T00:00:00Z">2018-09-03</time>
    <div class="post-description">Creating new features for the Costa Rican household poverty level prediction competition</div>
  </div>
</header>

    <div class="post-body" itemprop="articleBody">
      <div class="notebook">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The workflow from the previous post has been moved to a <a href="https://github.com/hello-klol/kaggle_poverty_prediction/blob/master/data_cleaner.py" target="_blank" rel="external">utility file</a>. First load data and check the utility functions have been correctly applied.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">data_cleaner</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">load_training_df</span><span class="p">()</span>\
<span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">clean_targets</span><span class="p">)</span>\
<span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">clean_non_numerics</span><span class="p">)</span>\
<span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">clean_missing_values</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_target_consistent</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">inconsistent_targets</span> <span class="o">=</span> <span class="n">is_target_consistent</span><span class="p">[</span><span class="n">is_target_consistent</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&apos;There are </span><span class="si">%d</span><span class="s1"> households with inconsistent target values&apos;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">inconsistent_targets</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>There are 0 households with inconsistent target values
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&apos;There are </span><span class="si">%d</span><span class="s1"> features of type </span><span class="si">%s</span><span class="s1">&apos;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">k</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>There are 136 features of type int64
There are 8 features of type float64
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nulls</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">nulls</span> <span class="o">=</span> <span class="n">nulls</span><span class="p">[</span><span class="n">nulls</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&apos;There are </span><span class="si">%d</span><span class="s1"> features of type null </span><span class="si">%s</span><span class="s1">&apos;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&apos;,&apos;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nulls</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>There are 0 features of type null 
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="New-features-for-individuals">New features for individuals<a class="anchor-link" href="#New-features-for-individuals">&#xB6;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before considering data at a household level there are some new features that may be useful to generate at an individual&apos;s level.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Education-level">Education-level<a class="anchor-link" href="#Education-level">&#xB6;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are 9 columns used as a binary one-hot encoding of the individuals level of education. We can compress this down to a single value to represent how far through education this individual has been.</p>
<p>There&apos;s slightly weird ordering here as <code>instlevel4</code> and <code>instlevel6</code> represent incomplete secondary school (academic or technical) and <code>instlevel5</code> and <code>instlevel7</code> represent complete secondary school. The ordering has been arranged based on inspecting correlation with household wealth.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">compress_columns</span><span class="p">,</span> <span class="n">new_col</span><span class="o">=</span><span class="s1">&apos;education-level&apos;</span><span class="p">,</span> 
        <span class="n">cols_to_compress</span><span class="o">=</span><span class="p">[</span><span class="s1">&apos;instlevel1&apos;</span><span class="p">,</span> <span class="s1">&apos;instlevel2&apos;</span><span class="p">,</span> <span class="s1">&apos;instlevel3&apos;</span><span class="p">,</span> <span class="s1">&apos;instlevel6&apos;</span><span class="p">,</span> <span class="s1">&apos;instlevel4&apos;</span><span class="p">,</span> <span class="s1">&apos;instlevel7&apos;</span><span class="p">,</span> 
                          <span class="s1">&apos;instlevel5&apos;</span><span class="p">,</span> <span class="s1">&apos;instlevel8&apos;</span><span class="p">,</span> <span class="s1">&apos;instlevel9&apos;</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&apos;education-level&apos;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[6]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>education-level</th>
    </tr>
    <tr>
      <th>idhogar</th>
      <th>Id</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>21eb7fcc1</th>
      <th>ID_279628684</th>
      <td>4</td>
    </tr>
    <tr>
      <th>0e5d7a658</th>
      <th>ID_f29eb3ddd</th>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="New-features-for-households">New features for households<a class="anchor-link" href="#New-features-for-households">&#xB6;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All new features from this point on will be descriptions at a household level so we&apos;ll append them all to a DataFrame indexed at household level.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hh_idx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">hh_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">hh_idx</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Household-size">Household size<a class="anchor-link" href="#Household-size">&#xB6;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In some cases there are features about the household that are more useful when broken down to a per-person ratio, such as number of ipads per person. There are quite a few different types of features indicating the number of people living in a household.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">existing_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&apos;tamviv&apos;</span><span class="p">,</span><span class="s1">&apos;tamhog&apos;</span><span class="p">,</span><span class="s1">&apos;hhsize&apos;</span><span class="p">,</span><span class="s1">&apos;hogar_total&apos;</span><span class="p">,</span><span class="s1">&apos;r4t3&apos;</span><span class="p">]</span>
<span class="n">hh_size</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&apos;hh_size&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">)</span>

<span class="n">hhsizes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">existing_features</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hh_size</span><span class="p">)</span>

<span class="n">features_are_equal</span> <span class="o">=</span> <span class="n">hhsizes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">hhsizes</span><span class="p">[</span><span class="o">~</span><span class="n">features_are_equal</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&apos;tamviv&apos;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[8]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tamviv</th>
      <th>tamhog</th>
      <th>hhsize</th>
      <th>hogar_total</th>
      <th>r4t3</th>
      <th>hh_size</th>
    </tr>
    <tr>
      <th>idhogar</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>d4e1dc02c</th>
      <td>15</td>
      <td>9</td>
      <td>9</td>
      <td>9</td>
      <td>9</td>
      <td>9</td>
    </tr>
    <tr>
      <th>3fb291710</th>
      <td>13</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>d43a04997</th>
      <td>13</td>
      <td>9</td>
      <td>9</td>
      <td>9</td>
      <td>9</td>
      <td>9</td>
    </tr>
    <tr>
      <th>29024a31c</th>
      <td>13</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0592dc939</th>
      <td>11</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hhsizes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&apos;r4t3&apos;</span><span class="p">,</span><span class="s1">&apos;tamhog&apos;</span><span class="p">,</span><span class="s1">&apos;hhsize&apos;</span><span class="p">,</span><span class="s1">&apos;hogar_total&apos;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hh_size</span><span class="p">)</span>
<span class="n">features_are_equal</span> <span class="o">=</span> <span class="n">hhsizes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">hhsizes</span><span class="p">[</span><span class="o">~</span><span class="n">features_are_equal</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[9]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>r4t3</th>
      <th>tamhog</th>
      <th>hhsize</th>
      <th>hogar_total</th>
      <th>hh_size</th>
    </tr>
    <tr>
      <th>idhogar</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>03c6bdf85</th>
      <td>5</td>
      <td>5</td>
      <td>5</td>
      <td>5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>048d64af0</th>
      <td>4</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>053f09ebb</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>09b195e7a</th>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <th>0ccab16a8</th>
      <td>5</td>
      <td>5</td>
      <td>5</td>
      <td>5</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unfortunately the different features have inconsistent values fairly frequently. <code>tamviv</code> is often the largest and has the description &quot;number of persons living in the household&quot;, it&apos;s not clear what this means in contrast to <code>tamhog</code>, &quot;size of the household&quot; or <code>hhsize</code>, &quot;household size&quot;. My guess would be that there are non-family members living in this household.</p>
<p>It may be a good indication of poverty if a household has additional members from outside the family.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">additional_hh_members</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;tamviv&apos;</span><span class="p">]</span><span class="o">!=</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;tamhog&apos;</span><span class="p">]][</span><span class="n">target_column</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="n">additional_hh_members</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[10]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>4    64
2    23
1    13
3    12
Name: Target, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">additional</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&apos;tamviv&apos;</span><span class="p">]</span><span class="o">-</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;tamhog&apos;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="n">additional</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">][</span><span class="n">target_column</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>4    48
2    17
3     9
1     9
Name: Target, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our generated value of household size is often smaller than the others, this is probably due to the fact it only counts individuals that data has been collected for and not necessarily the number of people in the household as a whole. We should use our generated value when getting the mean or proportion of data we are grouping ourselves. We should choose one of the other values when breaking down numbers that have been provided already representing household level data such as the number of phones or tablets a household owns.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Supporters-Dependents">Supporters-Dependents<a class="anchor-link" href="#Supporters-Dependents">&#xB6;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The data given to us calculates a dependency rate which looks at the number of adults between 19 and 64 (working age) vs the number of children or adults of 65+. This is likely to be due to the fact adults of working age will be supporting the household. Let&apos;s define a couple of terms:</p>
<ul>
<li><code>supporter</code> : Household member aged 19-64 who has not been marked as having a disability</li>
<li><code>dependent</code> : Household member aged 0-19, 65+, or is disabled</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We saw when cleaning the data that there are cases in which households have no supporters. We can add a couple of features to indicate whether there are no supporters in the household, or also no dependents in the household.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">supporters</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;age&apos;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;age&apos;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">64</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;dis&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span>
<span class="n">dependents</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;age&apos;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">18</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;age&apos;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">64</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;dis&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)]</span>

<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;num_supporters&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">supporters</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;num_dependents&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dependents</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;supporters_rate&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">supporters</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">hh_size</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;dependents_rate&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dependents</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">hh_size</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;0_supporters&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;num_supporters&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;0_dependents&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;num_dependents&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here our <code>dependents_rate</code> is the same idea as our previously calculated <code>dependency</code> feature however it&apos;s possible that some information is missing as it&apos;s been calculated from individual-level data. We can add in the dependency rate as well in case it&apos;s more helpful or accurate.</p>
<p>Remember that in this case the number of dependents is gathered from features <code>hogar_nin</code>, <code>hogar_mayor</code>, and the number of adults marked as disabled. And the household size value used is <code>hogar_total</code> - likely a higher value than our generated hh_size.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;dependency_rate&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&apos;dependency&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It may be useful to know the gender breakdown of supporters since there is a gender driven pay gap in most countries and this may have some effect on the wealth of the family.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m_supporters</span> <span class="o">=</span> <span class="n">supporters</span><span class="p">[</span><span class="n">supporters</span><span class="p">[</span><span class="s1">&apos;male&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span> 
<span class="n">f_supporters</span> <span class="o">=</span> <span class="n">supporters</span><span class="p">[</span><span class="n">supporters</span><span class="p">[</span><span class="s1">&apos;female&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span> 

<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;num_m_supporters&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_supporters</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;num_f_supporters&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_supporters</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Education">Education<a class="anchor-link" href="#Education">&#xB6;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Education-level of household supporters is likely to have a large impact on the wealth of the family as well. We already have the mean education of adults in the household, but let&apos;s make a new value for supporters, and supporters broken down by gender.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;meaneduc&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&apos;meaneduc&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;meaneduc_s&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">supporters</span><span class="p">[</span><span class="s1">&apos;escolari&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;meaneduc_m&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_supporters</span><span class="p">[</span><span class="s1">&apos;escolari&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;meaneduc_f&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_supporters</span><span class="p">[</span><span class="s1">&apos;escolari&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;ed_lev_s&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">supporters</span><span class="p">[</span><span class="s1">&apos;education-level&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;ed_lev_m&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_supporters</span><span class="p">[</span><span class="s1">&apos;education-level&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;ed_lev_f&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_supporters</span><span class="p">[</span><span class="s1">&apos;education-level&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since a member of the household has been assigned &apos;head-of-household&apos; it&apos;s possible that details relating this individual offer significant information about the household. We can add extra features from combinations of details about them.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hoh</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">head_of_household</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;male_hoh&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hoh</span><span class="p">[</span><span class="s1">&apos;male&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;educ_hoh&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hoh</span><span class="p">[</span><span class="s1">&apos;escolari&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;educ_hoh_m&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hoh</span><span class="p">[</span><span class="s1">&apos;edjefe&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;educ_hoh_f&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hoh</span><span class="p">[</span><span class="s1">&apos;edjefa&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;SQeduc_hoh_m&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hoh</span><span class="p">[</span><span class="s1">&apos;SQBedjefe&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;SQeduc_hoh_f&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hoh</span><span class="p">[</span><span class="s1">&apos;SQBedjefa&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;ed_lev_hoh&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hoh</span><span class="p">[</span><span class="s1">&apos;education-level&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;hoh_is_sup&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">hoh</span><span class="p">[</span><span class="s1">&apos;age&apos;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hoh</span><span class="p">[</span><span class="s1">&apos;age&apos;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">64</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hoh</span><span class="p">[</span><span class="s1">&apos;dis&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span>
                       <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Missing education is more significant for children as this indicates that they are falling behind rather than just showing the number of years they have been in education. Let&apos;s check for those under 18 who are falling behind in school. We&apos;ll only consider children without disabilities else the disability itself might be the cause of falling behind in school, rather than indicating it being due to wealth issues.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">minors</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;age&apos;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;dis&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span>

<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;missing_school&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minors</span><span class="p">[</span><span class="s1">&apos;rez_esc&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;missing_school_m&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minors</span><span class="p">[</span><span class="n">minors</span><span class="p">[</span><span class="s1">&apos;male&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">][</span><span class="s1">&apos;rez_esc&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;missing_school_f&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minors</span><span class="p">[</span><span class="n">minors</span><span class="p">[</span><span class="s1">&apos;female&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">][</span><span class="s1">&apos;rez_esc&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Rent">Rent<a class="anchor-link" href="#Rent">&#xB6;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can add in the values we were working with for whether monthly rent payments are owed, how much, and the stability of the household&apos;s residence.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;rent&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&apos;v2a1&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;pays_rent&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&apos;owes-montly-payments&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;residence-stability&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&apos;residence-stability&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What if a household owes rent payments but has no supporters:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;rent_problems&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;pays_rent&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;0_supporters&apos;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Possessions">Possessions<a class="anchor-link" href="#Possessions">&#xB6;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>While cleaning the data we also saw the feature describing the number of tablets a household owns. Let&apos;s add that and look more into features around the possessions of the household.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Binary values</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;refrig&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&apos;refrig&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;computer&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&apos;computer&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;television&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&apos;television&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">)</span>
<span class="c1"># Count of how many owned</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;tablets_ratio&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;v18q1&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">)</span><span class="o">/</span><span class="n">hh_size</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;mobilephones_ratio&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&apos;qmobilephone&apos;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">household_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">hh_idx</span><span class="p">)</span><span class="o">/</span><span class="n">hh_size</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Combinations of electronic possessions like these probably give some indication to wealth.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;electronics&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;refrig&apos;</span><span class="p">]</span> <span class="o">+</span> <span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;computer&apos;</span><span class="p">]</span> <span class="o">+</span> <span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;television&apos;</span><span class="p">]</span> <span class="o">+</span>
                        <span class="p">(</span><span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;tablets_ratio&apos;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span>
                        <span class="p">(</span><span class="n">hh_df</span><span class="p">[</span><span class="s1">&apos;mobilephones_ratio&apos;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Overcrowding">Overcrowding<a class="anchor-link" href="#Overcrowding">&#xB6;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Information has been provided about numbers of rooms and overcrowding. Let&apos;s take a look.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Overcrowding is the number of people divided by the number of bedrooms. Where overcrowding is 3 or above the binary value for overcrowding by bedroom is set to True.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#xA0;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&apos;rooms&apos;</span><span class="p">,</span><span class="s1">&apos;hacapo&apos;</span><span class="p">,</span><span class="s1">&apos;bedrooms&apos;</span><span class="p">,</span><span class="s1">&apos;hacdor&apos;</span><span class="p">,</span><span class="s1">&apos;overcrowding&apos;</span><span class="p">,</span><span class="s1">&apos;hhsize&apos;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[22]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>rooms</th>
      <th>hacapo</th>
      <th>bedrooms</th>
      <th>hacdor</th>
      <th>overcrowding</th>
      <th>hhsize</th>
    </tr>
    <tr>
      <th>idhogar</th>
      <th>Id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>21eb7fcc1</th>
      <th>ID_279628684</th>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1.000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>0e5d7a658</th>
      <th>ID_f29eb3ddd</th>
      <td>4</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1.000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2c7317ea8</th>
      <th>ID_68de51c94</th>
      <td>8</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0.500000</td>
      <td>1</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2b58d945f</th>
      <th>ID_d671db89c</th>
      <td>5</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>1.333333</td>
      <td>4</td>
    </tr>
    <tr>
      <th>ID_d56d6f5f5</th>
      <td>5</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>1.333333</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    </div>
  </div>
    </div>

<footer>
  <div class="post-nav">
    <div class="post-nav-prev post-nav-item">
      <a href="&#x2F;2018&#x2F;09&#x2F;02&#x2F;Poverty-Prediction-Kaggle-Competition-Data-Cleanup/" rel="prev" title="Poverty Prediction Kaggle Competition: Data Cleanup">
        <i class="fa fa-chevron-left"></i><div class="post-nav-item">Poverty Prediction Kaggle Competition: Data Cleanup</div>
      </a>
    </div>
    <span class="post-nav-divider"></span>
    <div class="post-nav-next post-nav-item">
      <a href="&#x2F;2018&#x2F;10&#x2F;03&#x2F;Atari-Breakout-In-JavaScript/" rel="next" title="Atari Breakout In JavaScript">
        <div class="post-nav-item">Atari Breakout In JavaScript</div><i class="fa fa-chevron-right"></i>
      </a>
    </div>
  </div>
</footer>
  </div>
</article>
  </body>
</html>
